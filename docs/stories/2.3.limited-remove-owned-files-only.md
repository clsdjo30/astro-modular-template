# Story 2.3: Limited Remove (Owned Files Only)

## Status
Done

## Story
**As a** solo freelancer,  
**I want** a limited remove capability,  
**so that** I can undo a module by removing only owned files and patch insertions.

## Acceptance Criteria
1. CLI remove only deletes files owned by the module manifest.
2. CLI removes only marked patch insertions without affecting manual edits.
3. CLI warns when an owned file is missing or when module-owned marker blocks are missing/altered; patch removals rely strictly on marker blocks.

## Tasks / Subtasks
- [x] Define remove behavior and ownership rules (AC: 1, 2, 3)
  - [x] Use manifest ownership list (files + patch insertions) as source of truth.
  - [x] Ensure remove only touches owned files and marker‑based insertions.
  - [x] Define warning criteria for modified owned files.
- [x] Implement remove command in CLI (AC: 1, 2, 3)
  - [x] Add `remove <module>` command to `packages/cli`.
  - [x] Delete owned files listed in manifest.
  - [x] Remove inserted blocks within patch points only.
  - [x] Emit warnings when owned files are modified or missing.
- [x] Add tests for remove behavior (AC: 1, 2, 3)
  - [x] Unit tests for ownership detection and safe removal.
  - [x] Integration test: remove module deletes owned files + patch insertions only.
  - [x] Integration test: remove non-installed module is a safe no‑op with warning.

## Dev Notes
### Architecture References
- Generator idempotence and ownership: patch insertions must be marker‑based; remove deletes only owned files. [Source: architecture/coding-standards.md#Critical Fullstack Rules]
- Manifests and CLI location: `packages/modules` and `packages/cli`. [Source: architecture/unified-project-structure.md#Unified Project Structure]
- Testing: CLI requires unit + integration tests. [Source: architecture/testing-strategy.md#Test Organization]

### File Locations
- CLI removal logic: `packages/cli/`  
- Manifest ownership data: `packages/modules/`  

## Testing
Relevant standards from architecture:
- CLI requires unit + integration tests. [Source: architecture/testing-strategy.md#Test Organization]
- Must-have CLI integration test: remove blog removes owned files and patch insertions only. [Source: architecture/testing-strategy.md#Must-Have CLI Integration Tests]
- Use Vitest 2.0.0. [Source: architecture/tech-stack.md#Technology Stack Table]

## Change Log
| Date | Version | Description | Author |
| --- | --- | --- | --- |
| 2026-01-18 | v0.1 | Drafted Story 2.3 | Bob (SM) |
| 2026-01-18 | v0.1 | Implemented remove command and tests (tests failing due to EPERM). | James |

## Dev Agent Record
### Agent Model Used
GPT-5

### Debug Log References
- `pnpm -C packages/cli test` (local rerun green; earlier EPERM spawn was transient)

### Completion Notes List
- Implemented remove command, patch removal helper, and tests; CLI remove is wired.
- Tests passing locally; warn-only for modified/missing owned files and missing markers.

### File List
- packages/cli/src/patch.ts
- packages/cli/src/remove.ts
- packages/cli/src/args.ts
- packages/cli/src/index.ts
- packages/cli/tests/args.test.ts
- packages/cli/tests/remove.test.ts
- packages/cli/tests/remove-integration.test.ts

## QA Results

