# Story 4.4: Cart & Checkout Flow

## Status
Done

## Story
**As a** solo freelancer,  
**I want** a cart and checkout flow,  
**so that** users can place orders end-to-end.

## Acceptance Criteria
1. Cart supports add/remove/update quantity and shows totals.
2. Cart state is stored server-side in session (no DB-persistent cart in v1).
3. Checkout collects customer details and confirms order submission.
4. Flow works without external payment providers in v1 unless explicitly enabled.

## Tasks / Subtasks
- [ ] Implement cart API routes (AC: 1, 2)
  - [ ] `GET /api/v1/cart`
  - [ ] `POST /api/v1/cart/items` (add)
  - [ ] `PATCH /api/v1/cart/items/{productId}` (update quantity)
  - [ ] `DELETE /api/v1/cart/items/{productId}` (remove)
  - [ ] Use session cart structure defined in data models.
- [ ] Add frontend cart services (AC: 1, 2)
  - [ ] Add `cartService` under `templates/presets/commerce/src/services/`.
  - [ ] Use fetch with credentials and `PUBLIC_API_BASE_URL`.
- [ ] Add cart and checkout pages (AC: 1, 3, 4)
  - [ ] Cart page: `/cart` -> `templates/presets/commerce/src/pages/cart.astro`
  - [ ] Checkout page: `/checkout` -> `templates/presets/commerce/src/pages/checkout.astro`
  - [ ] Add minimal client-side script for cart interactions (no framework).
  - [ ] Checkout submits customer details to order creation endpoint.
- [ ] Verify no external payments (AC: 4)
  - [ ] Ensure no payment provider SDKs are included.

## Dev Notes
### Architecture References
- Cart endpoints and rules. [Source: architecture/api-specification-rest.md]
- Cart data structure in session. [Source: architecture/data-models.md#Session]
- Frontend services and scripts. [Source: architecture/frontend-architecture.md#Frontend Services Layer]

### Dependencies
- Story 4.1 (API skeleton).
- Story 4.3 (product pages/services).
- Story 4.5 (order creation endpoint for checkout submission).

### Scope Boundaries (v1)
- Cart is session-only; no persistent cart table.
- No payment integrations in v1.

### File Locations
- API routes: `packages/api/src/routes/cart.routes.ts`
- API controllers/services: `packages/api/src/controllers/cart.controller.ts`, `packages/api/src/services/cart.service.ts`
- Frontend services: `templates/presets/commerce/src/services/`
- Pages: `templates/presets/commerce/src/pages/cart.astro`, `templates/presets/commerce/src/pages/checkout.astro`
- Script: `templates/presets/commerce/src/scripts/cart.ts`

## Testing
Relevant standards from architecture:
- Backend integration tests in `packages/api`. [Source: architecture/testing-strategy.md#Test Organization]
Manual verification:
- Add/remove/update cart items and see totals update.

## Change Log
| Date | Version | Description | Author |
| --- | --- | --- | --- |
| 2026-01-18 | v0.1 | Drafted Story 4.4 | Bob (SM) |

## Dev Agent Record
### Agent Model Used

### Debug Log References

### Completion Notes List

### File List

## QA Results
