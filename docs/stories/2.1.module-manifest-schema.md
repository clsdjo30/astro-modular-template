# Story 2.1: Module Manifest Schema

## Status
Done

## Story
**As a** solo freelancer,  
**I want** a module manifest schema,  
**so that** each module declares its files, dependencies, config keys, and patch points.

## Acceptance Criteria
1. Manifest includes module id, description, dependencies, conflicts, and ownership (explicit owned files + patch insertions).
2. Manifest lists added files and patch points with insertion rules (append/prepend/replace) and marker-based idempotence.
3. Manifest specifies config keys under modules.<name>.

## Tasks / Subtasks
- [x] Define manifest format and schema (AC: 1, 2, 3)
  - [x] Use YAML for manifests and document the schema.
  - [x] Define required fields: id, description, dependencies, conflicts, ownership (owned files + patch insertions).
  - [x] Define file additions and patch-point insertions with insertion rules (append/prepend/replace) and marker-based idempotence.
  - [x] Define config key namespace under `modules.<name>`.
- [x] Add schema validation and examples (AC: 1, 2, 3)
  - [x] Implement schema validation with Zod in `packages/shared` and re-use in `packages/cli`.
  - [x] Create one example manifest in `packages/modules/` to validate structure.
- [x] Document manifest usage (AC: 1, 2, 3)
  - [x] Add minimal docs describing manifest fields and purpose.

## Dev Notes
### Architecture References
- Repo structure: manifests live under `packages/modules` and are consumed by CLI in `packages/cli`. [Source: architecture/unified-project-structure.md#Unified Project Structure]
- Generator idempotence: patch-point insertions must be marker-based and idempotent. [Source: architecture/coding-standards.md#Critical Fullstack Rules]
- Module boundaries: shared types only via `packages/shared`. [Source: architecture/coding-standards.md#Critical Fullstack Rules]

### File Locations
- Manifests: `packages/modules/`  
- CLI: `packages/cli/`  
- Shared schema/types (if needed): `packages/shared/`  

### Schema Decisions (v1)
- **Format:** YAML (preferred for readability).
- **Ownership:** explicit list of files and patch insertions owned by the module; used for safe removal.
- **Patch-point fields:** location key + insertion rule (`append` | `prepend` | `replace`) + marker block for idempotence.
- **Validation:** Zod schema in `packages/shared` shared by CLI.

## Testing
Relevant standards from architecture:
- CLI and shared packages should have unit tests; integration tests in `packages/cli`. [Source: architecture/testing-strategy.md#Test Organization]
- Use Vitest 2.0.0. [Source: architecture/tech-stack.md#Technology Stack Table]

## Change Log
| Date | Version | Description | Author |
| --- | --- | --- | --- |
| 2026-01-18 | v0.1 | Drafted Story 2.1 | Bob (SM) |
| 2026-01-18 | v0.2 | Clarified YAML format, ownership, insertion rules, Zod validation | Bob (SM) |

## Dev Agent Record
### Agent Model Used
GPT-5

### Debug Log References
- No runtime validation or CLI execution in this story.

### Completion Notes List
- Added shared module manifest schema with Zod and type definitions.
- Added example module manifest and documentation.
- Exposed schema for CLI reuse.

### File List
- packages/shared/package.json
- packages/shared/index.js
- packages/shared/index.d.ts
- packages/cli/package.json
- packages/cli/src/manifest.ts
- packages/modules/example/manifest.yaml
- docs/module-manifest.md

## QA Results
