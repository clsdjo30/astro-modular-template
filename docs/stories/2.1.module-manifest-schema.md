# Story 2.1: Module Manifest Schema

## Status
Done

## Story
**As a** solo freelancer,  
**I want** a module manifest schema,  
**so that** each module declares its files, dependencies, config keys, and patch points.

## Acceptance Criteria
1. Manifest includes module id, description, dependencies, conflicts, and ownership (explicit owned files + patch insertions).
2. Manifest lists added files and patch points with insertion rules (append/prepend/replace) and marker-based idempotence.
3. Manifest specifies config keys under modules.<name>.

## Tasks / Subtasks
- [ ] Define manifest format and schema (AC: 1, 2, 3)
  - [ ] Use YAML for manifests and document the schema.
  - [ ] Define required fields: id, description, dependencies, conflicts, ownership (owned files + patch insertions).
  - [ ] Define file additions and patch-point insertions with insertion rules (append/prepend/replace) and marker-based idempotence.
  - [ ] Define config key namespace under `modules.<name>`.
- [ ] Add schema validation and examples (AC: 1, 2, 3)
  - [ ] Implement schema validation with Zod in `packages/shared` and re-use in `packages/cli`.
  - [ ] Create one example manifest in `packages/modules/` to validate structure.
- [ ] Document manifest usage (AC: 1, 2, 3)
  - [ ] Add minimal docs describing manifest fields and purpose.

## Dev Notes
### Architecture References
- Repo structure: manifests live under `packages/modules` and are consumed by CLI in `packages/cli`. [Source: architecture/unified-project-structure.md#Unified Project Structure]
- Generator idempotence: patch-point insertions must be marker-based and idempotent. [Source: architecture/coding-standards.md#Critical Fullstack Rules]
- Module boundaries: shared types only via `packages/shared`. [Source: architecture/coding-standards.md#Critical Fullstack Rules]

### File Locations
- Manifests: `packages/modules/`  
- CLI: `packages/cli/`  
- Shared schema/types (if needed): `packages/shared/`  

### Schema Decisions (v1)
- **Format:** YAML (preferred for readability).
- **Ownership:** explicit list of files and patch insertions owned by the module; used for safe removal.
- **Patch-point fields:** location key + insertion rule (`append` | `prepend` | `replace`) + marker block for idempotence.
- **Validation:** Zod schema in `packages/shared` shared by CLI.

## Testing
Relevant standards from architecture:
- CLI and shared packages should have unit tests; integration tests in `packages/cli`. [Source: architecture/testing-strategy.md#Test Organization]
- Use Vitest 2.0.0. [Source: architecture/tech-stack.md#Technology Stack Table]

## Change Log
| Date | Version | Description | Author |
| --- | --- | --- | --- |
| 2026-01-18 | v0.1 | Drafted Story 2.1 | Bob (SM) |
| 2026-01-18 | v0.2 | Clarified YAML format, ownership, insertion rules, Zod validation | Bob (SM) |

## Dev Agent Record
### Agent Model Used

### Debug Log References

### Completion Notes List

### File List

## QA Results
