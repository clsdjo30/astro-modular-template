# Story 1.1: Repository Structure & Base Template

## Status
Done

## Story
**As a** solo freelancer,  
**I want** a base Astro + TypeScript template with a minimal, clean structure,  
**so that** every generated project starts from a predictable foundation.

## Acceptance Criteria
1. Repo contains a minimal Astro 5 + TypeScript template that builds successfully on first run.
2. Toolchain pinned and verifiable:
   - `package.json` includes `"packageManager": "pnpm@10.0.0"`.
   - `package.json` includes `"engines": { "node": "22.19.0" }`.
   - Dependencies for Astro/TypeScript/ESLint/Prettier/Vitest are pinned with no loose majors (no `^` on the major).
   - `pnpm-lock.yaml` exists and is committed.
3. First-run verification (clean clone): `pnpm install && pnpm lint && pnpm typecheck && pnpm test && pnpm build` all succeed.
4. Minimal site pages exist (home + 404) and the build output is static-ready.
5. Basic project docs exist: README with setup, scripts, and pinned versions.

## Non-Goals
- No CLI commands (create/add/remove) in Story 1.1.
- No module system yet.
- No presets beyond the base template.
- No deployment automation yet.

## Definition of Done
- All acceptance criteria are met using a CI-like local run.
- Repository structure is aligned with the architecture and committed.
- Configs committed; no TODOs that block Story 1.2+.

## Repository Structure
- Generator/tooling repo top level: `packages/`, `templates/`, `docs/`, `examples/` [Source: architecture/unified-project-structure.md#Unified Project Structure]
- Base template structure (in `templates/base/`): `src/components/`, `src/pages/`, `src/services/`, `src/scripts/`, `src/config/` [Source: architecture/frontend-architecture.md#Component Architecture]

## Tasks / Subtasks
- [x] Scaffold base template folders and minimal pages (AC: 1, 4)
  - [x] Create `templates/base/src/pages/index.astro` and `templates/base/src/pages/404.astro` with a neutral layout shell.
  - [x] Ensure no JS framework is required by default.
- [x] Configure toolchain pinning and scripts (AC: 2, 3)
  - [x] Set `packageManager` and `engines.node` in base template `package.json`.
  - [x] Pin Astro/TypeScript/ESLint/Prettier/Vitest versions without loose major ranges.
  - [x] Add scripts: `lint`, `typecheck`, `test`, `build`, and `astro check` (if used).
  - [x] Generate and commit `pnpm-lock.yaml`.
- [x] Add minimal config files (AC: 3)
  - [x] ESLint + Prettier config aligned with pinned versions.
  - [x] TypeScript config and Astro config for static build.
- [x] Add README (AC: 5)
  - [x] Include setup, scripts, and pinned versions.
- [x] Verify first-run command sequence (AC: 3)
  - [x] Run the full command chain locally and confirm success.
- [x] Add placeholder test if needed (AC: 3)
  - [x] Ensure `pnpm test` runs and exits cleanly.

## Dev Notes
### Architecture References
- Toolchain versions and package manager: pnpm 10.0.0, Node 22.19.0, Astro 5.0.0, TypeScript 5.6.0, ESLint 9.0.0, Prettier 3.3.0, Vitest 2.0.0. Tailwind optional but not enabled in this story. [Source: architecture/tech-stack.md#Technology Stack Table]
- Generator repo structure: `packages/`, `templates/`, `docs/`, `examples/` [Source: architecture/unified-project-structure.md#Unified Project Structure]
- Base template component/page structure (for `templates/base/`): `src/components/`, `src/pages/`, `src/services/`, `src/scripts/`, `src/config/` [Source: architecture/frontend-architecture.md#Component Architecture]
- Coding standards: avoid cross-module imports, pin versions, no framework by default. [Source: architecture/coding-standards.md#Critical Fullstack Rules]
- Testing strategy: unit + integration overall; template tests optional; CLI tests not in scope for this story. [Source: architecture/testing-strategy.md#Testing Strategy]

### File Locations
- Base template lives in `templates/base/` (Astro app scaffold). [Source: architecture/unified-project-structure.md#Unified Project Structure]
- No specific guidance found in architecture docs for `source-tree.md` (file not present).

## Testing
Relevant standards from architecture:
- Testing pyramid is unit + integration; e2e optional. [Source: architecture/testing-strategy.md#Testing Strategy]
- Template tests are optional; for this story, ensure `pnpm test` runs (placeholder ok). [Source: architecture/testing-strategy.md#Test Organization]
- CLI integration tests are not part of Story 1.1. [Source: architecture/testing-strategy.md#Must-Have CLI Integration Tests]

## Change Log
| Date | Version | Description | Author |
| --- | --- | --- | --- |
| 2026-01-18 | v0.1 | Drafted Story 1.1 | Bob (SM) |
| 2026-01-19 | v0.2 | Implemented base template scaffold and configs (pending pnpm install) | James (Dev) |

## Dev Agent Record
### Agent Model Used
GPT-5

### Debug Log References
- pnpm test failed: vitest config load error (spawn EPERM)
- pnpm build failed: Astro build spawn EPERM in Vite optimize path
- pnpm test/build re-run succeeded after local fix (per user)

### Completion Notes List
- Base template scaffold, configs, and minimal pages added.
- `pnpm install --force` succeeded on your side; `pnpm-lock.yaml` generated.
- Validation chain run: `pnpm lint` and `pnpm typecheck` passed; `pnpm test` and `pnpm build` failed with spawn EPERM.
- Re-run validation: `pnpm test` and `pnpm build` passed after local fix.

### File List
- docs/architecture/source-tree.md
- templates/base/package.json
- templates/base/astro.config.mjs
- templates/base/tsconfig.json
- templates/base/eslint.config.js
- templates/base/.prettierrc.json
- templates/base/vitest.config.ts
- templates/base/pnpm-lock.yaml
- templates/base/README.md
- templates/base/src/env.d.ts
- templates/base/src/layouts/BaseLayout.astro
- templates/base/src/components/layout/Header.astro
- templates/base/src/components/layout/Footer.astro
- templates/base/src/pages/index.astro
- templates/base/src/pages/404.astro
- templates/base/src/services/.gitkeep
- templates/base/src/scripts/.gitkeep
- templates/base/src/config/.gitkeep
- templates/base/tests/smoke.test.ts

## QA Results
